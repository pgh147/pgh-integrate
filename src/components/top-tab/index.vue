<template>
  <div v-show="!isChildApp" class="pghui_toptab-topbar">
    <div class="pghui_toptab-topbar-left">
      <tab-bar v-if="tabShow" />
    </div>
    <div class="pghui_toptab-topbar-right" v-if="rightShow">
      <el-tooltip
        teleported
        placement="bottom"
        enterable
        :append-to="'#' + appendTo"
        effect="light"
        :hide-after="150"
        manual
        :stop-popper-mouse-event="false"
      >
        <template #content>
          <div class="pghui_toptab-topbar-logout" @click="logOut">退出系统</div>
        </template>
        <div
          class="pghui_toptab-topbar-tooltip-trigger pghui_toptab-topbar-role"
        >
          <svg
            class="pghui_toptab-topbar-tooltip-icon-user"
            width="14"
            height="14"
            viewBox="0 0 14 14"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M1.53125 11.0833C1.53125 9.63375 2.82767 8.75 4.42647 8.75H9.57353C11.1723 8.75 12.4688 9.63375 12.4688 11.0833V11.9583C12.4688 12.0357 12.4349 12.1099 12.3745 12.1646C12.3142 12.2193 12.2324 12.25 12.1471 12.25H1.85294C1.76762 12.25 1.6858 12.2193 1.62547 12.1646C1.56514 12.1099 1.53125 12.0357 1.53125 11.9583V11.0833Z"
              stroke="black"
            />
            <path
              d="M7 6.5625C8.32894 6.5625 9.40625 5.48519 9.40625 4.15625C9.40625 2.82731 8.32894 1.75 7 1.75C5.67106 1.75 4.59375 2.82731 4.59375 4.15625C4.59375 5.48519 5.67106 6.5625 7 6.5625Z"
              stroke="black"
            />
          </svg>
          <span>{{ userName }}</span>
        </div>
      </el-tooltip>

      <el-tooltip
        v-if="hrSysmtems.length"
        teleported
        placement="bottom"
        enterable
        :append-to="'#' + appendTo"
        effect="light"
        :hide-after="150"
        manual
        :stop-popper-mouse-event="false"
        popper-class="pghui_toptab-topbar-popper"
      >
        <template #content>
          <div
            v-for="item in hrSysmtems"
            class="pghui_toptab-topbar-tooltip-item"
            @click="hrJump(item.url)"
          >
            {{ item.title }}
          </div>
        </template>
        <div class="pghui_toptab-topbar-tooltip-trigger">
          <svg
            class="pghui_toptab-topbar-tooltip-icon-switch"
            width="13"
            height="13"
            viewBox="0 0 13 13"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M8.57438 12.4201C8.51538 12.3613 8.46857 12.2915 8.43663 12.2146C8.40469 12.1377 8.38825 12.0552 8.38825 11.972C8.38825 11.8887 8.40469 11.8063 8.43663 11.7294C8.46857 11.6525 8.51538 11.5827 8.57438 11.5239L10.6163 9.48088H1.0398C0.871774 9.48088 0.710628 9.41413 0.591813 9.29531C0.472999 9.1765 0.40625 9.01535 0.40625 8.84732C0.40625 8.67929 0.472999 8.51815 0.591813 8.39933C0.710628 8.28052 0.871774 8.21377 1.0398 8.21377H12.1749C12.1794 8.21267 12.184 8.21267 12.1885 8.21377C12.194 8.21308 12.1995 8.21308 12.205 8.21377C12.2118 8.21377 12.2169 8.21377 12.2248 8.21377H12.2367C12.2431 8.21441 12.2493 8.21555 12.2554 8.21717H12.2662L12.2861 8.22285C12.2895 8.22285 12.2929 8.22285 12.2963 8.22285C12.303 8.22432 12.3096 8.22622 12.3161 8.22852C12.3198 8.22944 12.3234 8.23058 12.3269 8.23192C12.3315 8.23192 12.3388 8.23532 12.3445 8.23759C12.3483 8.23933 12.3523 8.24047 12.3564 8.241L12.3717 8.24667C12.3766 8.24826 12.3813 8.25015 12.3859 8.25234L12.4001 8.25688L12.4154 8.26425L12.4284 8.26992C12.433 8.27333 12.4387 8.27446 12.4438 8.27843L12.4545 8.28297C12.4602 8.28694 12.4664 8.29034 12.4721 8.29374L12.4806 8.29942L12.4982 8.30963C12.5009 8.31175 12.5037 8.31364 12.5067 8.3153C12.5121 8.31924 12.5173 8.32361 12.522 8.32834C12.5254 8.32991 12.5283 8.33224 12.5305 8.33515C12.5361 8.338 12.5409 8.34207 12.5447 8.34706L12.5566 8.35784C12.56 8.36091 12.5636 8.36375 12.5674 8.36634C12.5828 8.38005 12.5974 8.39464 12.6111 8.41002C12.6146 8.41297 12.6175 8.41664 12.6196 8.4208L12.6304 8.43271C12.6334 8.43815 12.6374 8.44296 12.6423 8.44689C12.6423 8.45029 12.6479 8.45369 12.6491 8.45539C12.6502 8.4571 12.6565 8.4656 12.6621 8.47071C12.6678 8.47581 12.6655 8.47638 12.6667 8.47922C12.6678 8.48205 12.674 8.49113 12.6774 8.4968L12.6831 8.50531L12.6933 8.52289C12.6955 8.52633 12.6974 8.52994 12.699 8.53367C12.703 8.53934 12.7047 8.54388 12.7075 8.54898C12.7097 8.55243 12.7116 8.55603 12.7132 8.55976C12.7132 8.56543 12.7188 8.57053 12.7205 8.57507C12.7222 8.57961 12.7239 8.58358 12.7251 8.58925C12.7273 8.59385 12.7292 8.59859 12.7308 8.60343C12.7308 8.6091 12.7342 8.61421 12.7364 8.61874C12.7385 8.62278 12.7397 8.62724 12.7398 8.63179C12.7398 8.63633 12.7432 8.6437 12.7455 8.64937C12.747 8.65266 12.7481 8.65608 12.7489 8.65958C12.7489 8.66696 12.7523 8.67263 12.7546 8.67943C12.7568 8.68624 12.7546 8.68624 12.7546 8.69021C12.7562 8.69634 12.7574 8.70261 12.758 8.70893C12.758 8.71233 12.758 8.7163 12.758 8.71971C12.758 8.72311 12.758 8.73388 12.762 8.73956C12.7659 8.74523 12.762 8.74806 12.762 8.75147C12.762 8.75487 12.762 8.76338 12.762 8.77019C12.7613 8.77565 12.7613 8.78117 12.762 8.78663C12.7609 8.7913 12.7609 8.79615 12.762 8.80081C12.764 8.82175 12.764 8.84284 12.762 8.86377C12.7631 8.86843 12.7631 8.87329 12.762 8.87795C12.7626 8.88341 12.7626 8.88894 12.762 8.8944C12.762 8.90121 12.762 8.90631 12.762 8.91312C12.762 8.91992 12.762 8.92163 12.762 8.92616C12.762 8.9307 12.7619 8.93978 12.758 8.94488C12.754 8.94999 12.758 8.95225 12.758 8.95566C12.7561 8.96173 12.7549 8.96802 12.7546 8.97437C12.7546 8.97834 12.7546 8.98175 12.7546 8.98515L12.7489 9.005C12.7481 9.00851 12.747 9.01192 12.7455 9.01521C12.7455 9.02088 12.7421 9.02826 12.7398 9.03279C12.7381 9.03695 12.7369 9.04135 12.7364 9.04584C12.7364 9.05038 12.733 9.05605 12.7308 9.06115C12.7292 9.066 12.7273 9.07073 12.7251 9.07533C12.7251 9.08101 12.7217 9.08384 12.7205 9.08951C12.7194 9.09519 12.7149 9.09972 12.7132 9.10483C12.7116 9.10856 12.7097 9.11216 12.7075 9.1156C12.7041 9.12128 12.703 9.12581 12.699 9.13092C12.6974 9.13465 12.6955 9.13825 12.6933 9.1417L12.6831 9.15928L12.6774 9.16779C12.674 9.17346 12.6706 9.1797 12.6667 9.18537C12.6627 9.19104 12.6633 9.19104 12.6621 9.19388C12.6583 9.19944 12.654 9.20458 12.6491 9.20919C12.6477 9.21264 12.6453 9.2156 12.6423 9.2177C12.6394 9.22326 12.6354 9.22811 12.6304 9.23188C12.627 9.23528 12.623 9.24039 12.6196 9.24492L12.6088 9.25513C12.602 9.26251 12.5952 9.27158 12.5878 9.27839L9.46827 12.4053C9.40957 12.4642 9.33982 12.5109 9.26303 12.5428C9.18624 12.5747 9.1039 12.5911 9.02076 12.5911C8.93761 12.5911 8.85527 12.5747 8.77848 12.5428C8.70169 12.5109 8.63194 12.4642 8.57324 12.4053L8.57438 12.4201ZM1.04207 4.79587H1.01031C1.0035 4.79247 0.998398 4.79247 0.994995 4.7902C0.989559 4.79122 0.983982 4.79122 0.978546 4.7902H0.959829C0.955859 4.7902 0.951321 4.7902 0.946784 4.7902C0.940473 4.78951 0.934218 4.78837 0.928066 4.7868C0.924663 4.7868 0.920693 4.7868 0.91729 4.7868C0.910377 4.78299 0.90391 4.77842 0.898005 4.77319H0.887228L0.867377 4.76751C0.864083 4.76607 0.860666 4.76494 0.857167 4.76411C0.851495 4.76411 0.844122 4.76071 0.839584 4.75844C0.83555 4.75633 0.831089 4.75517 0.826539 4.75504L0.811225 4.74936L0.797045 4.74369C0.792205 4.7421 0.787469 4.74021 0.782865 4.73802C0.777641 4.73603 0.772529 4.73376 0.767551 4.73121L0.75564 4.72554L0.739191 4.71647L0.728982 4.7108C0.72331 4.70739 0.715937 4.70399 0.711399 4.70059L0.702891 4.69491L0.684741 4.68641C0.681338 4.68641 0.680203 4.683 0.676233 4.68073C0.670788 4.67722 0.665663 4.67324 0.660919 4.66882C0.657312 4.66625 0.654069 4.66319 0.651277 4.65975C0.645849 4.6567 0.641039 4.65266 0.637097 4.64784C0.633694 4.64557 0.628589 4.64217 0.625186 4.63876C0.621921 4.63554 0.618306 4.63268 0.614409 4.63025C0.598528 4.61607 0.584348 4.60303 0.570168 4.58601C0.566941 4.58275 0.564088 4.57913 0.56166 4.57524C0.558257 4.57183 0.554854 4.56673 0.551451 4.56333C0.548327 4.55681 0.543885 4.55102 0.538406 4.54631C0.536337 4.54402 0.534058 4.54193 0.531599 4.54007C0.528223 4.53468 0.52443 4.52956 0.520256 4.52476C0.520256 4.52079 0.516285 4.51908 0.514584 4.51625C0.512882 4.51341 0.506643 4.5032 0.50324 4.49867C0.501956 4.49542 0.500239 4.49237 0.498135 4.48959C0.494732 4.48392 0.491329 4.47655 0.487926 4.47201C0.484522 4.46747 0.484522 4.46463 0.482254 4.46123C0.479985 4.45783 0.476582 4.45045 0.473746 4.44592C0.47091 4.44138 0.470343 4.43854 0.468074 4.43287C0.465805 4.4272 0.463536 4.42436 0.463536 4.41869L0.457864 4.40508L0.452193 4.3909C0.452193 4.38523 0.448789 4.38012 0.446521 4.37445C0.444787 4.37068 0.44364 4.36666 0.443117 4.36254C0.443117 4.35687 0.439714 4.35063 0.437446 4.34496C0.436523 4.3413 0.435386 4.3377 0.434042 4.33418L0.42837 4.31546C0.42837 4.31206 0.42837 4.30809 0.42837 4.30469C0.425481 4.29855 0.423385 4.29207 0.422131 4.2854C0.422131 4.28143 0.422131 4.27803 0.422131 4.27463C0.422131 4.27122 0.422131 4.26045 0.418728 4.25477C0.415325 4.2491 0.418728 4.24627 0.418728 4.24286C0.418728 4.23946 0.418728 4.23095 0.418728 4.22301C0.419351 4.21793 0.419351 4.21278 0.418728 4.2077C0.419859 4.20304 0.419859 4.19818 0.418728 4.19352C0.417376 4.17236 0.417376 4.15115 0.418728 4.12999C0.417623 4.12552 0.417623 4.12085 0.418728 4.11638C0.41804 4.11092 0.41804 4.10539 0.418728 4.09993C0.418728 4.09312 0.418728 4.08802 0.418728 4.08008C0.418728 4.07214 0.418728 4.07157 0.418728 4.06817C0.419366 4.06185 0.420504 4.05559 0.422131 4.04945C0.422131 4.04548 0.422131 4.04208 0.422131 4.03867C0.424315 4.03226 0.42565 4.02558 0.426102 4.01882C0.426102 4.01542 0.426102 4.01202 0.426102 4.00861C0.426102 4.00521 0.429505 3.99557 0.431774 3.98876C0.433622 3.98572 0.435143 3.98248 0.436311 3.97912C0.436311 3.97458 0.439714 3.96721 0.441983 3.96154C0.443999 3.95787 0.445162 3.9538 0.445386 3.94962L0.451058 3.93431L0.45673 3.92013L0.463536 3.90538C0.463536 3.89971 0.469208 3.89461 0.470343 3.89007C0.471477 3.88553 0.473746 3.8827 0.476015 3.87929C0.478283 3.87589 0.478851 3.86568 0.482254 3.86568C0.485657 3.86568 0.485657 3.85831 0.487926 3.8549L0.498135 3.83732C0.500214 3.83372 0.501924 3.82992 0.50324 3.82598L0.514016 3.80896C0.515822 3.80576 0.51791 3.80272 0.520256 3.79989C0.523373 3.79397 0.527181 3.78845 0.531599 3.78344C0.533547 3.78036 0.53583 3.77751 0.538406 3.77493C0.542195 3.76972 0.546573 3.76496 0.551451 3.76075C0.554854 3.75735 0.558257 3.75224 0.56166 3.74884L0.572437 3.73863C0.579243 3.73126 0.586617 3.72218 0.593423 3.71537L3.71638 0.591851C3.83522 0.473013 3.9964 0.40625 4.16446 0.40625C4.33252 0.40625 4.4937 0.473013 4.61254 0.591851C4.73138 0.71069 4.79814 0.87187 4.79814 1.03993C4.79814 1.208 4.73138 1.36918 4.61254 1.48801L2.57065 3.5299H12.1443C12.3123 3.5299 12.4735 3.59665 12.5923 3.71547C12.7111 3.83428 12.7778 3.99543 12.7778 4.16346C12.7778 4.33148 12.7111 4.49263 12.5923 4.61145C12.4735 4.73026 12.3123 4.79701 12.1443 4.79701L1.04207 4.79587Z"
              fill="black"
            />
          </svg>
          <span>切换</span>
        </div>
      </el-tooltip>
    </div>
  </div>
</template>
<script lang="ts">
import { ref, onMounted, reactive } from "vue";
import TabBar from "./tabbar.vue";
export default {
  name: "TopTab",
};
</script>
<script lang="ts" setup>
export interface Props {
  showTab?: boolean;
  appendTo?: string;
  hrSysmtems?: HrSystemItem[];
}

export interface AuthInfo {
  employeeName: string;
  employeeNo: string;
}

export interface HrSystemItem {
  title: string;
  url: string;
}

const props = withDefaults(defineProps<Props>(), {
  showTab: true,
  appendTo: "app",
  hrSysmtem: false,
});
// 是否子应用
const isChildApp = !!(window as any).__POWERED_BY_QIANKUN__;
const tabShow = ref(!!props.showTab);

const isChild = !!(window as any).__POWERED_BY_QIANKUN__;

const userName = ref("员工");
const rightShow = ref(!isChild);
const hrSysmtems: any = reactive([]);

onMounted(async () => {
  //   const authInfo: AuthInfo = getAuthInfoSync() as AuthInfo;
  userName.value = "test"; //authInfo.employeeName;
  if (props.hrSysmtems && props.hrSysmtems.length && !hrSysmtems.length) {
    parseHrSystems();
  }
});

const logOut = () => {
  //TODO
};

const parseHrSystems = () => {
  hrSysmtems.push(...(props.hrSysmtems as HrSystemItem[]));
};

const hrJump = (url: string) => {
  window.open(url);
};
</script>
<style scoped lang="scss">
@import "./index.scss";
</style>
